<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ginto Tunnel Dashboard</title>
  <link rel="icon" type="image/png" href="/static/favicon.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#98a0b3; --accent:#3b82f6; --accent-2:#7c3aed; --success:#10b981; --danger:#ef4444; --glass: rgba(255,255,255,0.03);
      --radius:10px; --text:#e6eef8; --muted-2:#9fb0c8;
      --title-size: clamp(1.5rem, 1.1rem + 1.4vw, 2.2rem);
      --lead-size: clamp(0.95rem, 0.88rem + 0.28vw, 1.15rem);
      --control-size: clamp(0.98rem, 0.92rem + 0.2vw, 1.06rem);
      --input-bg-dark: #1e293b; /* Dark background for input fields in dark mode */
      --input-border-dark: #334155; /* Darker border for input fields in dark mode */
      --input-text-dark: #e2e8f0; /* Light text for input fields in dark mode */
    }
    :root[data-theme='light']{
      --bg: #ffffff; /* Pure white background for better contrast */
      --card: #f8f9fa; /* Light gray for cards */
      --muted: #6c757d; /* Medium gray for muted text */
      --text: #212529; /* Darker text for readability */
      --glass: rgba(0, 0, 0, 0.1); /* Slightly darker glass effect */
      --accent: #007bff; /* Blue accent color */
      --accent-2: #6610f2; /* Purple accent color */
      --logs-bg: #f1f3f5; /* Light gray background for logs area */
      --input-bg-light: #f0f0f0; /* Slightly dark gray background for input fields */
      --input-border-light: #d1d5db; /* Light gray border for input fields */
      --input-text-light: #212529; /* Dark text for input fields */
      --input-bg-dark: #1e293b; /* Dark background for input fields in dark mode */
      --input-border-dark: #334155; /* Darker border for input fields in dark mode */
      --input-text-dark: #e2e8f0; /* Light text for input fields in dark mode */
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;transition:background .25s,color .2s}
      .wrap{max-width:1100px;margin:18px auto;padding:12px}
      header{display:flex;align-items:flex-start;gap:14px;flex-wrap:wrap}
      .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700}
      .header-copy{flex:1;min-width:240px}
    h1{font-size:var(--title-size);line-height:1.08;margin:0;letter-spacing:-0.02em}
    p.lead{margin:0;color:var(--muted);font-size:var(--lead-size);line-height:1.35;max-width:64ch}

      .controls-card{background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.12);margin-top:12px;display:flex;flex-direction:column;gap:10px}
      .form-row{display:flex;gap:8px}
      .controls-grid{display:grid;grid-template-columns:1fr;gap:8px;align-items:stretch}
      .field{min-width:0}
      .field input{width:100%;box-sizing:border-box}
      .controls-actions{display:flex;align-items:center;justify-content:stretch}
      input,button,select{padding:10px;border-radius:10px;border:1px solid var(--input-border-dark);background:var(--input-bg-dark);color:var(--input-text-dark);outline:none;font-size:var(--control-size);min-height:46px}
      :root[data-theme='light'] input,
      :root[data-theme='light'] select{padding:10px;border-radius:8px;border:1px solid var(--input-border-light);background:var(--input-bg-light);color:var(--input-text-light);outline:none}
      input:disabled{background:var(--card);color:var(--muted);border-color:var(--input-border-dark);cursor:not-allowed}
      :root[data-theme='light'] input:disabled{background:var(--card);color:var(--muted);border-color:var(--input-border-light)}
      button{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;border:1px solid rgba(255,255,255,0.08);cursor:pointer;font-weight:600;letter-spacing:0.01em;transition:transform .14s ease,box-shadow .2s ease,filter .2s ease,opacity .2s ease;box-shadow:0 6px 14px rgba(59,130,246,0.28);border-radius:14px}
      button:hover{transform:translateY(-1px);filter:saturate(1.05);box-shadow:0 10px 18px rgba(59,130,246,0.32)}
      button:active{transform:translateY(0);box-shadow:0 4px 10px rgba(59,130,246,0.25)}
      button:focus-visible{outline:2px solid rgba(255,255,255,0.35);outline-offset:2px}
      :root[data-theme='light'] button:focus-visible{outline:2px solid rgba(0,0,0,0.25)}
      button:disabled{opacity:0.55;cursor:not-allowed;transform:none;box-shadow:none}
      .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
      .theme-toggle{background:linear-gradient(90deg,var(--accent),var(--accent-2));display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:none;box-shadow:none;font-weight:500;min-height:42px}
      .header-meta{margin-top:10px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
      .header-note{margin-top:8px;color:var(--muted);font-size:var(--lead-size);line-height:1.35}
      .session-tools{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;align-items:center;justify-content:stretch;margin-left:auto;width:100%}
      .session-tools > *{flex:0 0 auto}
      .session-tools button{width:100%;justify-content:center;text-align:center}
      .console-btn{padding:8px 12px;border-radius:999px;min-height:42px}
      .user-pill{display:inline-flex;align-items:center;padding:8px 12px;border-radius:999px;background:var(--glass);border:1px solid rgba(255,255,255,0.08);font-size:clamp(0.88rem,0.83rem + 0.2vw,1rem);color:var(--muted-2);min-height:38px}
      :root[data-theme='light'] .user-pill{border:1px solid rgba(0,0,0,0.1)}
      .logout-btn{background:linear-gradient(135deg,#ef4444,#dc2626);box-shadow:0 6px 14px rgba(239,68,68,0.24);padding:8px 12px;border-radius:999px}
      .table-card{margin-top:12px;background:var(--glass);padding:10px;border-radius:10px}
      table{width:100%;border-collapse:collapse;font-size:14px}
      thead th{font-size:12px;text-align:left;color:var(--muted);padding:8px 6px}
      tbody td{padding:10px 6px;border-top:1px solid rgba(255,255,255,0.03)}
      .small{font-size:12px;color:var(--muted)}
      #createBtn{padding:12px 20px;border-radius:16px;font-size:clamp(1rem,0.95rem + 0.2vw,1.15rem);font-weight:700}
      .row-actions{display:flex;flex-wrap:wrap;gap:6px}
      .row-actions button{margin-right:0;padding:7px 10px;border-radius:12px;font-size:13px;line-height:1}

      .badge{display:inline-block;padding:6px 8px;border-radius:999px;font-size:12px}
      .badge.running{background:linear-gradient(90deg, rgba(16,185,129,0.12), rgba(16,185,129,0.06));color:var(--success);border:1px solid rgba(16,185,129,0.15)}
      .badge.stopped{background:linear-gradient(90deg, rgba(239,68,68,0.06), rgba(239,68,68,0.02));color:var(--danger);border:1px solid rgba(239,68,68,0.1)}
      .badge.protocol{font-weight:700;letter-spacing:0.04em;padding:6px 10px}
      .badge.proto-http{background:rgba(59,130,246,0.12);color:#2563eb;border:1px solid rgba(37,99,235,0.35)}
      .badge.proto-https{background:rgba(16,185,129,0.15);color:#047857;border:1px solid rgba(4,120,87,0.38)}

      .muted{color:var(--muted)}

      #logsArea{margin-top:12px;background:var(--logs-bg);padding:10px;border-radius:8px;min-height:160px}
      pre{background:transparent;color:#cde8d9;margin:0;white-space:pre-wrap;word-break:break-word;max-height:360px;overflow:auto}

      .modal-overlay{position:fixed;inset:0;background:rgba(2,6,23,0.68);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px}
      .modal-overlay.open{display:flex}
      .modal-card{width:min(460px,100%);background:var(--card);border:1px solid rgba(255,255,255,0.08);border-radius:14px;box-shadow:0 18px 48px rgba(2,6,23,0.45);padding:16px}
      :root[data-theme='light'] .modal-card{border:1px solid rgba(0,0,0,0.1);box-shadow:0 18px 44px rgba(0,0,0,0.2)}
      .modal-title{margin:0 0 8px 0;font-size:18px}
      .modal-text{margin:0;color:var(--muted)}
      .modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:14px}
      .modal-cancel{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.16);box-shadow:none}
      :root[data-theme='light'] .modal-cancel{border:1px solid rgba(0,0,0,0.18)}
      .modal-danger{background:linear-gradient(135deg,#ef4444,#dc2626);box-shadow:0 8px 16px rgba(239,68,68,0.28)}

      .console-overlay{position:fixed;inset:0;background:rgba(2,6,23,0.82);display:none;z-index:1100}
      .console-overlay.open{display:block}
      .console-window{height:100%;display:flex;flex-direction:column;background:#050a17;color:#dbe7ff}
      .console-topbar{height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#111933;border-bottom:1px solid rgba(255,255,255,0.08)}
      .console-title{font-weight:700;font-size:16px}
      .console-actions{display:flex;gap:8px;align-items:center}
      .console-actions button{padding:8px 12px;border-radius:10px}
      .console-actions .btn-ghost{color:#dbe7ff;border-color:rgba(255,255,255,0.24)}
      .console-actions .btn-ghost:hover{background:rgba(255,255,255,0.08)}
      .console-tabbar{height:52px;display:flex;align-items:center;gap:8px;padding:0 10px;background:#151f36;border-bottom:1px solid rgba(255,255,255,0.08)}
      .console-tabs{display:flex;gap:8px;align-items:center;overflow:auto;flex:1 1 auto}
      .console-tab{display:inline-flex;align-items:center;gap:8px;min-width:150px;max-width:260px;padding:8px 10px;border-radius:10px;background:#1e2a44;border:1px solid rgba(255,255,255,0.12);color:#dbe7ff;cursor:pointer}
      .console-tab.active{border-color:rgba(59,130,246,0.9);box-shadow:0 0 0 1px rgba(59,130,246,0.35) inset}
      .console-tab-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;text-align:left}
      .console-tab-state{width:8px;height:8px;border-radius:999px;background:#ef4444;flex:0 0 auto}
      .console-tab-state.connected{background:#22c55e}
      .console-tab-close{border:none;background:transparent;color:#cbd5e1;cursor:pointer;padding:0 2px;font-size:14px;line-height:1}
      .console-panels{flex:1 1 auto;min-height:0;position:relative}
      .console-panel{position:absolute;inset:0;display:none}
      .console-panel.active{display:block}
      .console-term{height:100%;width:100%}
      .console-dock{position:fixed;right:18px;bottom:18px;z-index:1090;display:flex;flex-direction:column-reverse;gap:10px}
      .console-bubble{width:56px;height:56px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;position:relative}
      .console-bubble-state{position:absolute;right:4px;bottom:4px;width:10px;height:10px;border-radius:999px;background:#ef4444;border:2px solid #0b1220}
      .console-bubble-state.connected{background:#22c55e}

      /* mobile first: show list cards for small screens */
      .list-cards{display:flex;flex-direction:column;gap:8px}
      .card{background:var(--card);padding:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
      .card .meta{display:flex;flex-direction:column}
      .mobile-instance{background:var(--card);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:10px}
      .mobile-card{background:transparent;padding:0;border-radius:0;display:flex;justify-content:space-between;align-items:flex-start;gap:10px}
      .mobile-actions{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
      .mobile-actions button{width:100%;display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 8px}

      @media(min-width:700px){
        .controls-grid{grid-template-columns:repeat(3,minmax(130px,1fr))}
      }
      @media(min-width:900px){
        .session-tools{display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin-left:auto;width:auto}
        .session-tools button{width:auto}
        .list-cards{display:none}
        .table-card{display:block}
      }
      @media(max-width:899px){
        .table-card{display:none}
      }
      @media(min-width:1100px){
        .controls-grid{grid-template-columns:repeat(5,minmax(130px,1fr))}
      }
      @media(max-width:700px){
        .wrap{padding:10px}
        .header-copy{min-width:0}
        h1{font-size:clamp(1.95rem, 1.75rem + 1.2vw, 2.4rem);line-height:1.1}
        p.lead{font-size:clamp(1.2rem,1.05rem + 0.5vw,1.35rem);line-height:1.3}
        .header-meta{margin-top:8px}
        .controls-actions{justify-content:stretch}
        #createBtn{width:100%}
        .mobile-actions{grid-template-columns:1fr 1fr}
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="logo">GT</div>
        <div class="header-copy">
          <h1>Ginto Tunnel Dashboard</h1>
          <p class="lead">Manage local frpc instances and view live logs â€” local only (127.0.0.1:2026)</p>
          <div class="header-meta">
            <span id="sessionUser" class="user-pill">User: -</span>
          </div>
          <div id="headerText" class="header-note"></div>
        </div>
        <div class="session-tools">
          <button id="consoleBtn" class="console-btn" title="Open Console">&gt;_ Console</button>
          <button id="logoutBtn" class="logout-btn" title="Log out">Logout</button>
          <button id="themeBtn" class="theme-toggle" title="Toggle theme">ðŸŒ™ <span id="themeLabel">Dark</span></button>
        </div>
      </header>

      <div class="controls-card">
        <div class="controls-grid">
          <div class="field">
            <label for="instanceId" class="small" style="display:block;margin:0 0 6px 2px;">Instance ID</label>
            <input id="instanceId" placeholder="instance id (optional)" />
          </div>
          <div class="field">
            <label for="proxyName" class="small" style="display:block;margin:0 0 6px 2px;">Name</label>
            <input id="proxyName" placeholder="name (proxy name)" />
          </div>
          <div class="field">
            <label for="subdomain" class="small" style="display:block;margin:0 0 6px 2px;">Subdomain</label>
            <input id="subdomain" placeholder="subdomain" />
          </div>
          <div class="field">
            <label for="serverAddr" class="small" style="display:block;margin:0 0 6px 2px;">Server Address</label>
            <input id="serverAddr" value="ginto.ai" placeholder="server addr" disabled />
          </div>
          <div class="field">
            <label for="localPort" class="small" style="display:block;margin:0 0 6px 2px;">App Port to expose</label>
            <input id="localPort" placeholder="11434" />
          </div>
        </div>
        <div class="controls-actions" style="gap:8px">
          <button id="cleanDeletedBtn" class="btn-ghost" type="button">Clean Deleted Instances</button>
          <button id="createBtn">Create Instance</button>
        </div>
        <div class="small">Tip: configure name, subdomain, and local app port; public access remains TLS at the edge.</div>
      </div>

      <div class="list-cards" id="cardsArea"></div>

      <div class="table-card">
        <h3 style="margin:6px 0">Instances</h3>
        <table id="instancesTable">
          <thead><tr><th>Name</th><th>Protocol</th><th>Status</th><th>Details</th><th>PID</th><th>Uptime</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <h3 style="margin-top:14px">Logs</h3>
      <div id="logsArea"><em>Select an instance and click 'View Logs'</em></div>
    </div>

    <div id="confirmModal" class="modal-overlay" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
        <h4 id="confirmTitle" class="modal-title">Delete instance?</h4>
        <p id="confirmText" class="modal-text">This action cannot be undone.</p>
        <div class="modal-actions">
          <button id="confirmCancel" class="modal-cancel" type="button">Cancel</button>
          <button id="confirmDelete" class="modal-danger" type="button">Delete</button>
        </div>
      </div>
    </div>

    <div id="consoleModal" class="console-overlay" aria-hidden="true">
      <div class="console-window">
        <div class="console-topbar">
          <div class="console-title">&gt;_ Console</div>
          <div class="console-actions">
            <button id="consoleNewTabBtn" class="btn-ghost" type="button">+ Tab</button>
            <button id="consoleReconnectBtn" class="btn-ghost" type="button">Reconnect</button>
            <button id="consoleMinimizeBtn" class="btn-ghost" type="button">Minimize</button>
            <button id="consoleCloseBtn" class="btn-ghost" type="button">Close</button>
          </div>
        </div>
        <div class="console-tabbar">
          <div id="consoleTabs" class="console-tabs"></div>
        </div>
        <div id="consolePanels" class="console-panels"></div>
      </div>
    </div>

    <div id="consoleDock" class="console-dock" aria-live="polite"></div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="/static/app.js"></script>
  </body>
  </html>
